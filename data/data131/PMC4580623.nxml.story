Designing new protein–ligand interactions has tremendous potential for engineering sensitive biosensors for diagnostics or new enzymes useful in biotechnology, but these applications are extremely challenging, both because of inaccuracies of the energy functions used in modeling and design, and because protein active and binding sites are highly sensitive to subtle changes in structure. Here we describe a new method that addresses the second problem and couples changes in the structure of the protein backbone and of the amino acid side chains, the amino acid sequence, and the conformation of the ligand and its orientation in the binding site. We show that our method improvements significantly increase the accuracy of designing protein–ligand interactions compared to current state-of-the-art design methods. We assess these improvements in two important tests: the first predicts mutations that change ligand-binding preferences in enzymes, and the second predicts protein sequences that bind a given ligand. In these tests, subtle conformational changes made in our model are essential to recapitulate both the results from engineering experiments and the sequence diversity occurring in natural protein families. These results therefore shed light on the mechanisms of how new protein functions might have emerged and can be engineered in the laboratory.